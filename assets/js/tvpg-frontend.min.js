jQuery(document).ready(function ($) { if (!$(".tvpg-main-slider").length) return; var thumbSlider = new Swiper(".tvpg-thumb-slider", { spaceBetween: 10, slidesPerView: 4, freeMode: !0, watchSlidesProgress: !0, breakpoints: { 320: { slidesPerView: 3 }, 640: { slidesPerView: 4 }, 1024: { slidesPerView: 5 } } }), mainSlider = new Swiper(".tvpg-main-slider", { spaceBetween: 10, navigation: { nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev" }, thumbs: { swiper: thumbSlider } }), settings = "undefined" != typeof tvpgParams ? tvpgParams.settings : { autoplay: !1, mute_autoplay: !0 }; function playVideo(slide) { if (settings.autoplay) { var video = $(slide).find("video").get(0), iframe = $(slide).find("iframe"); if (video) { settings.mute_autoplay && (video.muted = !0); var playPromise = video.play(); void 0 !== playPromise && playPromise.catch(function () { }) } else if (iframe.length) { var src = iframe.attr("src") || iframe.attr("data-src") || ""; -1 !== src.indexOf("youtube") ? (settings.mute_autoplay && iframe.get(0).contentWindow.postMessage('{"event":"command","func":"mute","args":""}', '*'), iframe.get(0).contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*')) : -1 !== src.indexOf("vimeo") && (settings.mute_autoplay && iframe.get(0).contentWindow.postMessage('{"method":"setVolume", "value":0}', '*'), iframe.get(0).contentWindow.postMessage('{"method":"play"}', '*')) } } } function pauseVideo(slide) { var video = $(slide).find("video").get(0), iframe = $(slide).find("iframe"); if (video) video.pause(); else if (iframe.length) { var src = iframe.attr("src") || iframe.attr("data-src") || ""; -1 !== src.indexOf("youtube") ? iframe.get(0).contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*') : -1 !== src.indexOf("vimeo") && iframe.get(0).contentWindow.postMessage('{"method":"pause"}', '*') } } $(".tvpg-main-slider").on("click", ".tvpg-video-slide video", function () { this.controls || (this.paused ? this.play() : this.pause()) }), $(".tvpg-main-slider").on("click", ".tvpg-lazy-facade", function () { var $facade = $(this); if (!$facade.hasClass("tvpg-loaded")) { var embedUrl = $facade.data("embed-url"), provider = $facade.data("provider"); if (embedUrl) { var iframe = document.createElement("iframe"); iframe.src = embedUrl, iframe.setAttribute("frameborder", "0"), iframe.setAttribute("allowfullscreen", ""), iframe.setAttribute("allow", "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"), "youtube" === provider ? iframe.setAttribute("title", "YouTube video player") : "vimeo" === provider && iframe.setAttribute("title", "Vimeo video player"), $facade.append(iframe), $facade.addClass("tvpg-loaded") } } }), mainSlider.on("slideChange", function () { $(".tvpg-main-slider .swiper-slide").each(function () { pauseVideo(this) }); var activeSlide = mainSlider.slides[mainSlider.activeIndex]; $(activeSlide).hasClass("tvpg-video-slide") && playVideo(activeSlide) }); var initialSlide = mainSlider.slides[mainSlider.activeIndex]; $(initialSlide).hasClass("tvpg-video-slide") && playVideo(initialSlide); var $firstImageSlide = $(".tvpg-main-slider .swiper-slide:not(.tvpg-video-slide)").first(), $firstImage = $firstImageSlide.find("img"), originalImage = { src: $firstImage.attr("src"), srcset: $firstImage.attr("srcset"), alt: $firstImage.attr("alt"), index: $firstImageSlide.index() }, $videoSlide = $(".tvpg-main-slider .swiper-slide.tvpg-video-slide").first(), originalVideoHtml = $videoSlide.length ? $videoSlide.find(".woocommerce-product-gallery__image").html() : "", $videoThumbSlide = $(".tvpg-thumb-slider .swiper-slide.tvpg-video-thumb-slide").first(), originalVideoThumbHtml = $videoThumbSlide.length ? $videoThumbSlide.html() : ""; function setExpectedVideoState(html) { window.tvpgCurrentVideoState = html } function clearExpectedVideoState() { window.tvpgCurrentVideoState = null } window.tvpgCurrentVideoState = null, window.tvpgPulse || (window.tvpgPulse = setInterval(function () { if (window.tvpgCurrentVideoState) { var $slide = $(".tvpg-main-slider .swiper-slide.tvpg-video-slide").first(); if ($slide.length) { var hasVideo = $slide.find("video, iframe").length > 0, hasImage = $slide.find("img.wp-post-image").length > 0, isEmpty = $slide.find(".woocommerce-product-gallery__image").is(":empty"); !hasVideo && (hasImage || isEmpty) && (0 === $slide.find(".woocommerce-product-gallery__image").length ? $slide.html('<div class="woocommerce-product-gallery__image">' + window.tvpgCurrentVideoState + "</div>") : $slide.find(".woocommerce-product-gallery__image").html(window.tvpgCurrentVideoState), playVideo($slide)) } } }, 500)), $(document).on("found_variation", function (event, variation) { handleVariation(variation) }); var handleVariation = function (variation) { variation && setTimeout(function () { var $currentVideoSlide = $(".tvpg-main-slider .swiper-slide.tvpg-video-slide").first(), $currentVideoThumbSlide = $(".tvpg-thumb-slider .swiper-slide.tvpg-video-thumb-slide").first(), $currentFirstImageSlide = $(".tvpg-main-slider .swiper-slide:not(.tvpg-video-slide)").first(), $currentFirstImage = $currentFirstImageSlide.find("img"); if (variation.tvpg_video_html) if (setExpectedVideoState(variation.tvpg_video_html), $currentVideoSlide.length) $currentVideoSlide.find(".woocommerce-product-gallery__image").html(variation.tvpg_video_html), mainSlider && mainSlider.slides && mainSlider.slideTo($currentVideoSlide.index()), playVideo($currentVideoSlide), $currentVideoThumbSlide.length && variation.tvpg_video_thumb_html && $currentVideoThumbSlide.html(variation.tvpg_video_thumb_html); else { var newSlideHtml = '<div class="swiper-slide tvpg-video-slide tvpg-dynamic-slide"><div class="woocommerce-product-gallery__image">' + variation.tvpg_video_html + "</div></div>", newThumbHtml = '<div class="swiper-slide tvpg-video-thumb-slide tvpg-dynamic-slide">' + (variation.tvpg_video_thumb_html || '<span class="tvpg-play-icon"></span>') + "</div>", hasPlaceholder = $(".tvpg-placeholder-slide").length > 0, newIndex; hasPlaceholder ? (mainSlider && (mainSlider.prependSlide(newSlideHtml), mainSlider.update()), thumbSlider && (thumbSlider.prependSlide(newThumbHtml), thumbSlider.update()), newIndex = 0) : (mainSlider && (mainSlider.appendSlide(newSlideHtml), mainSlider.update()), thumbSlider && (thumbSlider.appendSlide(newThumbHtml), thumbSlider.update()), newIndex = mainSlider && mainSlider.slides ? mainSlider.slides.length - 1 : 0), mainSlider && mainSlider.slides && (mainSlider.slideTo(newIndex), playVideo($(mainSlider.slides[newIndex]))) } else { if (clearExpectedVideoState(), $(".tvpg-dynamic-slide").length) { if (mainSlider) { var indices = []; $(mainSlider.slides).each(function (i, s) { $(s).hasClass("tvpg-dynamic-slide") && indices.push(i) }), indices.sort((a, b) => b - a), indices.forEach(i => mainSlider.removeSlide(i)), mainSlider.update() } if (thumbSlider) { var indicesT = []; $(thumbSlider.slides).each(function (i, s) { $(s).hasClass("tvpg-dynamic-slide") && indicesT.push(i) }), indicesT.sort((a, b) => b - a), indicesT.forEach(i => thumbSlider.removeSlide(i)), thumbSlider.update() } } $currentVideoSlide.length && originalVideoHtml && !$currentVideoSlide.hasClass("tvpg-dynamic-slide") && ($currentVideoSlide.find(".woocommerce-product-gallery__image").html(originalVideoHtml), $currentVideoThumbSlide.length && originalVideoThumbHtml && $currentVideoThumbSlide.html(originalVideoThumbHtml)) } variation && variation.image && variation.image.src && variation.image.src.length > 1 && ($currentFirstImage.length && ($currentFirstImage.attr("src", variation.image.full_src || variation.image.src), $currentFirstImage.attr("srcset", variation.image.srcset || ""), $currentFirstImage.attr("alt", variation.image.alt || "")), thumbSlider && thumbSlider.slides && originalImage.index >= 0 && thumbSlider.slides[originalImage.index] && (($thumbSlide = $(thumbSlider.slides[originalImage.index])).find("img").length && $thumbSlide.find("img").attr("src", variation.image.gallery_thumbnail_src || variation.image.thumb_src || variation.image.src)), variation.tvpg_video_html || mainSlider && mainSlider.slides && mainSlider.slideTo($currentFirstImageSlide.index())) }, 50) }; $(document).on("reset_image", "form.variations_form", function () { if (clearExpectedVideoState(), $firstImage.length && originalImage.src && ($firstImage.attr("src", originalImage.src), $firstImage.attr("srcset", originalImage.srcset || ""), $firstImage.attr("alt", originalImage.alt || "")), mainSlider = $(".tvpg-main-slider")[0].swiper, thumbSlider = $(".tvpg-thumb-slider")[0].swiper, $(".tvpg-dynamic-slide").length) { if (mainSlider) { var indices = []; $(mainSlider.slides).each(function (i, s) { $(s).hasClass("tvpg-dynamic-slide") && indices.push(i) }), indices.sort((a, b) => b - a), indices.forEach(i => mainSlider.removeSlide(i)), mainSlider.update() } if (thumbSlider) { var indicesT = []; $(thumbSlider.slides).each(function (i, s) { $(s).hasClass("tvpg-dynamic-slide") && indicesT.push(i) }), indicesT.sort((a, b) => b - a), indicesT.forEach(i => thumbSlider.removeSlide(i)), thumbSlider.update() } } var $currentVideoSlide = $(".tvpg-main-slider .swiper-slide.tvpg-video-slide").first(); $currentVideoSlide.length && originalVideoHtml && !$currentVideoSlide.hasClass("tvpg-dynamic-slide") && $currentVideoSlide.find(".woocommerce-product-gallery__image").html(originalVideoHtml), mainSlider && mainSlider.slideTo(originalImage.index) }) });
